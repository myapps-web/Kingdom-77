# 🎫 دليل نظام التذاكر - Kingdom-77 Bot v3.0

## 📋 المحتويات
1. [نظرة عامة](#نظرة-عامة)
2. [إعداد النظام (للإدارة)](#إعداد-النظام)
3. [إدارة الفئات](#إدارة-الفئات)
4. [إنشاء لوحة التذاكر](#إنشاء-لوحة-التذاكر)
5. [أوامر المستخدمين](#أوامر-المستخدمين)
6. [أوامر فريق الدعم](#أوامر-فريق-الدعم)
7. [الأرشفة والنصوص](#الأرشفة-والنصوص)
8. [أمثلة عملية](#أمثلة-عملية)
9. [استكشاف الأخطاء](#استكشاف-الأخطاء)

---

## 🌟 نظرة عامة

نظام التذاكر في Kingdom-77 Bot هو نظام دعم فني متكامل يتيح للأعضاء إنشاء تذاكر خاصة للتواصل مع فريق الدعم.

### ✨ الميزات الرئيسية

- 🏷️ **نظام فئات متعدد**: إنشاء فئات مختلفة للتذاكر (دعم فني، شكاوى، اقتراحات، إلخ)
- 🔐 **قنوات خاصة**: كل تذكرة لها قناة خاصة منفصلة
- 👥 **إدارة المشاركين**: إضافة/إزالة أعضاء من التذكرة
- 📝 **حفظ النصوص**: حفظ تلقائي لنصوص المحادثات
- 🎯 **نظام المطالبة**: يمكن لفريق الدعم المطالبة بالتذاكر
- 🔔 **إشعارات تلقائية**: منشن تلقائي لفريق الدعم
- ⏱️ **إغلاق تلقائي**: إغلاق التذاكر غير النشطة
- 📊 **إحصائيات شاملة**: تتبع أداء نظام الدعم
- 🎨 **واجهة تفاعلية**: أزرار ونماذج تفاعلية

---

## ⚙️ إعداد النظام

### الخطوة 1: تفعيل النظام

استخدم أمر `/ticketsetup` لتفعيل وإعداد النظام:

```
/ticketsetup enabled:True
```

### الخطوة 2: إعداد القنوات

```
/ticketsetup 
  ticket_category: [اختر الكاتيجوري]
  transcript_channel: [قناة حفظ النصوص]
  logs_channel: [قناة السجلات]
```

### الخطوة 3: ضبط الإعدادات

```
/ticketsetup 
  max_tickets: 3
  delete_on_close: False
```

### معاملات `/ticketsetup`

| المعامل | الوصف | القيمة الافتراضية |
|---------|-------|-------------------|
| `enabled` | تفعيل/تعطيل النظام | `False` |
| `ticket_category` | الكاتيجوري للتذاكر | `None` |
| `transcript_channel` | قناة النصوص | `None` |
| `logs_channel` | قناة السجلات | `None` |
| `max_tickets` | أقصى تذاكر لكل مستخدم | `3` |
| `delete_on_close` | حذف القناة عند الإغلاق | `False` |

### عرض الإعدادات الحالية

```
/ticketsetup
```
(بدون معاملات لعرض الإعدادات الحالية)

---

## 🏷️ إدارة الفئات

### إنشاء فئة جديدة

```
/ticketcategory create
  category_id: "support"
  name: "دعم فني"
  description: "للمساعدة في المشاكل التقنية"
  emoji: "🛠️"
  discord_category: [اختر كاتيجوري اختياري]
```

#### ⚠️ ملاحظات مهمة:
- `category_id` يجب أن يكون بالإنجليزية بدون مسافات (مثل: `support`, `bug_report`, `suggestions`)
- يمكنك إنشاء حتى 25 فئة مختلفة
- يمكن تخصيص كاتيجوري Discord منفصل لكل فئة

### عرض جميع الفئات

```
/ticketcategory list
```

### تفعيل/تعطيل فئة

```
/ticketcategory toggle
  category_id: "support"
  enabled: True
```

### حذف فئة

```
/ticketcategory delete
  category_id: "support"
```

### 📝 أمثلة فئات شائعة

#### 1. دعم فني
```
category_id: "tech_support"
name: "دعم فني"
emoji: "🛠️"
description: "للمساعدة في المشاكل التقنية"
```

#### 2. الشكاوى
```
category_id: "complaints"
name: "شكاوى"
emoji: "⚠️"
description: "للإبلاغ عن المخالفات أو الشكاوى"
```

#### 3. الاقتراحات
```
category_id: "suggestions"
name: "اقتراحات"
emoji: "💡"
description: "لمشاركة أفكارك واقتراحاتك"
```

#### 4. طلبات الشراكة
```
category_id: "partnerships"
name: "طلبات الشراكة"
emoji: "🤝"
description: "للتواصل بخصوص الشراكات"
```

---

## 🎨 إنشاء لوحة التذاكر

### إنشاء اللوحة الرئيسية

```
/ticketpanel channel: [اختر القناة]
```

ستنشئ اللوحة رسالة مع زر "إنشاء تذكرة" الذي يمكن للأعضاء الضغط عليه.

### ما الذي يحدث عند إنشاء اللوحة؟

1. ✅ يتم إرسال رسالة Embed جميلة مع جميع الفئات
2. ✅ يتم إضافة زر "🎫 إنشاء تذكرة"
3. ✅ عند الضغط على الزر، تظهر قائمة منسدلة لاختيار الفئة
4. ✅ بعد الاختيار، يظهر نموذج لإدخال الموضوع والوصف
5. ✅ يتم إنشاء قناة خاصة تلقائياً

---

## 👤 أوامر المستخدمين

### إنشاء تذكرة

#### الطريقة 1: استخدام الأمر
```
/ticket create
```
ثم اختر الفئة من القائمة المنسدلة.

#### الطريقة 2: استخدام اللوحة
اضغط على زر "إنشاء تذكرة" في اللوحة الرئيسية.

### إغلاق تذكرتك

```
/ticket close reason: "تم حل المشكلة"
```

أو اضغط على زر "🔒 إغلاق التذكرة" داخل قناة التذكرة.

### ما يحدث عند إنشاء تذكرة:

1. ✅ يتم إنشاء قناة خاصة باسم `ticket-[رقم]`
2. ✅ يمكنك فقط أنت وفريق الدعم رؤية القناة
3. ✅ يتم إرسال رسالة ترحيب مع تفاصيل تذكرتك
4. ✅ يتم منشن الرتب المسؤولة (إن وجدت)
5. ✅ يتم حفظ التذكرة في قاعدة البيانات

---

## 🛡️ أوامر فريق الدعم

### إغلاق تذكرة

```
/ticket close reason: "تم حل المشكلة"
```

### إضافة عضو للتذكرة

```
/ticket add user: @العضو
```

### إزالة عضو من التذكرة

```
/ticket remove user: @العضو
```

### المطالبة بالتذكرة

```
/ticket claim
```
سيتم تعيينك كمسؤول عن هذه التذكرة.

### حفظ نص المحادثة

```
/ticket transcript
```

---

## 📄 الأرشفة والنصوص

### نظام حفظ النصوص التلقائي

عند إغلاق التذكرة، يتم تلقائياً:

1. ✅ جمع جميع الرسائل من القناة
2. ✅ حفظ النص في قاعدة البيانات
3. ✅ إرسال ملخص إلى قناة النصوص (إن وجدت)

### ما يتم حفظه:

- 📝 محتوى جميع الرسائل
- 👤 أسماء المستخدمين
- 🕐 الأوقات والتواريخ
- 📎 روابط المرفقات
- 📊 إحصائيات التذكرة

---

## 💡 أمثلة عملية

### مثال 1: إعداد نظام تذاكر كامل

```bash
# الخطوة 1: التفعيل والإعداد
/ticketsetup enabled:True ticket_category:[Support Category] max_tickets:3

# الخطوة 2: إنشاء الفئات
/ticketcategory create category_id:"tech_support" name:"دعم فني" description:"للمساعدة التقنية" emoji:"🛠️"
/ticketcategory create category_id:"reports" name:"بلاغات" description:"للإبلاغ عن المخالفات" emoji:"⚠️"
/ticketcategory create category_id:"suggestions" name:"اقتراحات" description:"لمشاركة الأفكار" emoji:"💡"

# الخطوة 3: إنشاء اللوحة
/ticketpanel channel:#tickets
```

### مثال 2: سير العمل النموذجي لتذكرة

1. **المستخدم**: يضغط على زر "إنشاء تذكرة"
2. **البوت**: يعرض قائمة الفئات
3. **المستخدم**: يختار "دعم فني"
4. **البوت**: يفتح نموذج إدخال
5. **المستخدم**: يكتب موضوع ووصف المشكلة
6. **البوت**: ينشئ قناة `ticket-001`
7. **فريق الدعم**: يستخدم `/ticket claim` للمطالبة
8. **فريق الدعم**: يحل المشكلة ويستخدم `/ticket close`
9. **البوت**: يحفظ النص ويغلق القناة

---

## 📊 الإحصائيات والتقارير

### عرض إحصائيات السيرفر

استخدم `/ticketsetup` (بدون معاملات) لرؤية:

- 📈 إجمالي التذاكر المنشأة
- ✅ إجمالي التذاكر المغلقة
- 🔓 التذاكر المفتوحة حالياً
- ⏱️ متوسط وقت الحل

---

## 🔧 إعدادات متقدمة

### نظام الحدود

```python
max_tickets_per_user: 3  # أقصى تذاكر مفتوحة لكل مستخدم
```

### نظام الإغلاق التلقائي

```python
auto_close_enabled: False  # (قريباً)
auto_close_after_hours: 24  # (قريباً)
```

### نظام الحذف

```python
delete_on_close: False  # حذف القناة عند الإغلاق
delete_after_minutes: 5  # الوقت قبل الحذف
```

### رسالة الترحيب المخصصة

يمكنك تخصيص رسالة الترحيب لكل فئة عن طريق تعديل قاعدة البيانات:

```python
welcome_message: "مرحباً {user}! شكراً لتواصلك معنا. سيتم الرد عليك قريباً."
```

---

## 🛠️ استكشاف الأخطاء

### المشكلة: لا يمكن إنشاء تذكرة

**الحل:**
1. تأكد من تفعيل النظام: `/ticketsetup enabled:True`
2. تأكد من وجود فئات مفعلة: `/ticketcategory list`
3. تحقق من أن المستخدم لم يصل للحد الأقصى من التذاكر المفتوحة

### المشكلة: لا تظهر اللوحة

**الحل:**
1. تأكد من أن البوت لديه صلاحية `Send Messages` و `Embed Links` في القناة
2. أعد إنشاء اللوحة: `/ticketpanel`

### المشكلة: لا يتم إنشاء القناة

**الحل:**
1. تأكد من أن البوت لديه صلاحية `Manage Channels`
2. تأكد من وجود مساحة كافية في السيرفر (أقل من 500 قناة)
3. تحقق من أن الكاتيجوري محدد في الإعدادات

### المشكلة: لا يتم حفظ النصوص

**الحل:**
1. تحقق من الاتصال بـ MongoDB
2. تأكد من تفعيل `save_transcripts` في الإعدادات
3. تحقق من صلاحية `Read Message History` للبوت

---

## 📋 قائمة الأوامر الكاملة

### أوامر المستخدمين
| الأمر | الوصف |
|------|-------|
| `/ticket create` | إنشاء تذكرة جديدة |
| `/ticket close` | إغلاق تذكرتك |

### أوامر فريق الدعم
| الأمر | الوصف |
|------|-------|
| `/ticket close` | إغلاق أي تذكرة |
| `/ticket add` | إضافة عضو للتذكرة |
| `/ticket remove` | إزالة عضو من التذكرة |
| `/ticket claim` | المطالبة بالتذكرة |
| `/ticket transcript` | حفظ نص المحادثة |

### أوامر الإدارة
| الأمر | الوصف |
|------|-------|
| `/ticketsetup` | إعداد النظام |
| `/ticketcategory create` | إنشاء فئة |
| `/ticketcategory list` | عرض الفئات |
| `/ticketcategory toggle` | تفعيل/تعطيل فئة |
| `/ticketcategory delete` | حذف فئة |
| `/ticketpanel` | إنشاء لوحة التذاكر |

---

## 🗄️ بنية قاعدة البيانات

### Collections المستخدمة

1. **`tickets`** - بيانات التذاكر
2. **`ticket_categories`** - الفئات
3. **`guild_ticket_config`** - إعدادات السيرفرات
4. **`ticket_transcripts`** - النصوص المحفوظة

### مثال على مستند تذكرة

```json
{
  "guild_id": 123456789,
  "user_id": 987654321,
  "ticket_number": 42,
  "channel_id": 111222333,
  "category": "tech_support",
  "status": "open",
  "subject": "مشكلة في البوت",
  "priority": "normal",
  "assigned_to": null,
  "participants": [987654321],
  "created_at": "2025-01-15T12:00:00Z",
  "updated_at": "2025-01-15T12:00:00Z",
  "closed_at": null,
  "message_count": 0
}
```

---

## 🎯 أفضل الممارسات

### للإدارة

1. ✅ أنشئ فئات واضحة ومحددة
2. ✅ حدد رتب الدعم بشكل صحيح
3. ✅ راقب الإحصائيات بانتظام
4. ✅ احفظ النصوص دائماً للمراجعة

### لفريق الدعم

1. ✅ استخدم `/ticket claim` عند البدء بالعمل على تذكرة
2. ✅ أضف السبب عند إغلاق التذاكر
3. ✅ استخدم `/ticket add` لإضافة متخصصين آخرين إذا لزم الأمر
4. ✅ كن محترفاً ومهذباً في الردود

### للمستخدمين

1. ✅ اختر الفئة المناسبة لتذكرتك
2. ✅ اكتب وصفاً واضحاً ومفصلاً للمشكلة
3. ✅ كن صبوراً وانتظر رد فريق الدعم
4. ✅ أغلق التذكرة بنفسك بعد حل المشكلة

---

## 🚀 ميزات قادمة

- [ ] نظام أولويات التذاكر
- [ ] نظام تقييم الدعم
- [ ] إغلاق تلقائي للتذاكر غير النشطة
- [ ] تصدير النصوص بصيغة HTML
- [ ] نظام القوالب الجاهزة
- [ ] إحصائيات متقدمة لفريق الدعم
- [ ] نظام SLA (Service Level Agreement)

---

## 📞 الدعم

إذا واجهت أي مشكلة أو لديك اقتراحات:
- 📧 تواصل مع مطور البوت
- 📝 افتح Issue على GitHub
- 💬 انضم إلى سيرفر الدعم

---

**Kingdom-77 Bot v3.0** - نظام التذاكر 🎫
